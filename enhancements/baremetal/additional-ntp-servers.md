---
title: additional-ntp-servers
authors:
  - "@tdomnesc"
reviewers:
  - "@dtantsur"
approvers:
  - "@zaneb"
api-approvers:
  - None
creation-date: 2024-11-08
last-updated: 2024-11-08
tracking-link:
  - "https://issues.redhat.com/browse/METAL-1022"
see-also:
  - "https://issues.redhat.com/browse/OCPBUGS-22957"
---

# Support additional NTP servers in install-config that would be passed to IPA

## Summary

When provisioning the initial cluster using bare-metal IPI installer, or provisioning additional workers using the Metal platform components (Metal3 and Ironic), there is no way to synchronize the hardware clock when the provisioning ramdisk is running. If the clock skew with the bootstrap VM or the control plane is large enough, the temporary TLS certificate generated by the agent inside the ramdisks will be considered either not valid yet or already invalid by Ironic causing the install to fail.

A new field is required in install-config.yaml where the user can specify additional NTP servers that can then be used to set up a chrony config in the image customization of Ironic Python Agent and Cluster Baremetal Operator.

## Motivation

Users are trying to install Openshift clusters in environments without internet access and would like to be able to use custom internal NTP servers, as they don't want to manually update the time on each server. As stated above, if the time is more than 1 hour in the future the install will fail.

### User Stories

As a user, I want to specify custom NTP servers in install-config so that I can install a cluster without internet access.

### Goals

Have a dedicated install-config field where a user can specify a list of custom NTP servers that IPA will then sync to.

### Non-Goals

Pass the new field to anywhere else (MCO for example) but to where is specified in the Proposal.

## Proposal

A new field in install-config will hold a list of NTP servers that will then be passed to the boostrap VM and from there to Ironic and Image Customization Controller. And from install-config to the cluster and then Cluster Baremetal Operator and Ironic.

The proposed field is `platform.baremetal.additionalNTPServers`. Description: additionalNTPServers is a list of additional NTP servers to use for provisioning. Type: array. Items: string. Values: List of hostnames or IP addresses.

### Workflow Description

- user inputs list of NTP servers
- installer sets the environment variable for image-customization-controller and Ironic
- the additional NTP servers are appended to the chrony config on masters
- installer sets the key/value in the baremetal-provisioning-config for cluster-baremetal-operator
- cluster-baremetal-operator configures the image customization
- the additional NTP servers are appended to the chrony config on workers

### API Extensions

Not applicable.

### Topology Considerations

#### Hypershift / Hosted Control Planes

#### Standalone Clusters

#### Single-node Deployments or MicroShift

### Implementation Details/Notes/Constraints

### Risks and Mitigations

### Drawbacks

## Open Questions [optional]

## Test Plan

A setup similar to what our custumers report: servers with the time set in the future by over one hour. With this setup and a custom NTP server the setup should complete succesfully.

## Graduation Criteria

Immediatly GA.

### Dev Preview -> Tech Preview

### Tech Preview -> GA

## Upgrade / Downgrade Strategy

## Version Skew Strategy

## Operational Aspects of API Extensions

## Support Procedures

## Alternatives

Customers need to manually set the clock in the BIOS for each server which is tedious and error-prone.

## Infrastructure Needed [optional]

### Removing a deprecated feature
